<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bin.myblog.dao.BlogMapper">
    <select id="getBlogById" resultType="com.bin.myblog.pojo.Blog" parameterType="java.lang.Long">
        select * from blog where id = #{id}
    </select>

    <insert id="saveBlog" parameterType="com.bin.myblog.pojo.Blog">
        insert into blog (title,content,
        firstPicture,flag,views,appreciation,
        shareStatement,comment,published,
        recommend,createTime,updateTime,userId,typeId,description)
         values (#{title},#{content},
         #{firstPicture},#{flag},#{views},#{appreciation},
         #{shareStatement},#{comment},#{published},
         #{recommend},#{createTime},#{updateTime},#{userId},#{typeId},#{description})
    </insert>

    <update id="updateBlog" parameterType="com.bin.myblog.pojo.Blog">
        update blog set
            title=#{title},
            content=#{content},
            firstPicture=#{firstPicture},
            flag=#{flag},
            appreciation=#{appreciation},
            shareStatement=#{shareStatement},
            comment=#{comment},
            published=#{published},
            recommend=#{recommend},
            updateTime=#{updateTime},
            typeId=#{typeId},
            description=#{description}
             where id = #{id}
    </update>

    <select id="listBlog" parameterType="map" resultType="com.bin.myblog.pojo.Blog">
        select * from blog
        <where>
            <if test="title != null">
                title like concat("%",#{title},"%")
            </if>
            <if test="typeId != null">
                and typeId=#{typeId}
            </if>
            <if test="recommend">
                and recommend = #{recommend}
            </if>
        </where>
        limit #{startIndex} ,#{currentCount}
    </select>

    <delete id="deleteBlog" parameterType="java.lang.Long">
        delete from blog where id = #{id}
    </delete>

    <select id="countBlog" resultType="int">
        select count(*) from blog
    </select>

    <select id="getBlogByPublished" resultType="com.bin.myblog.pojo.Blog" parameterType="map">
        select * from blog
        <where>
            <if test="published">
                published = #{published}
            </if>
            <if test="queryText != null">
                and title like concat("%",#{queryText},"%") or content like concat("%",#{queryText},"%")
            </if>
        </where>
         limit #{startIndex} ,#{currentCount}
    </select>

    <select id="getHotBlog" resultType="com.bin.myblog.pojo.Blog">
        select * from blog order by views DESC limit 3
    </select>

    <select id="getPublishedBlog" resultType="com.bin.myblog.pojo.Blog">
        select * from blog where published = true limit 5
    </select>

    <select id="getBlogByTypeId" resultType="com.bin.myblog.pojo.Blog" parameterType="map">
        select * from blog where typeId = #{id} limit #{startIndex} ,#{currentCount}
    </select>
</mapper>